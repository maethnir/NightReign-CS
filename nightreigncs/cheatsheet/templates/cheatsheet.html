{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nightfarer Viewer</title>
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
</head>
<body>
  <div class="locations-column">
    {% for location in locations %}
      <div class="location-item">
        <div class="location-left">
          <img class="location-img" src="{{ location.image.url }}" alt="{{ location.name }}">
        </div>
        <div class="location-right">
          <p><b>{{ location.name }}</b> (Lvl {{ location.min_level }} - {{ location.recommended_level }})</p>
          {% for it in location.contains.all %}
            <img class="loot-img" src="{{ it.icon.url }}" alt="{{ it.name }}"></img>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="info-column">

    <div class="nightlord-section">
      <div class="nightlord-selection" id="nightlord-selection">
        <select id="expedition-select" onchange="selectExpedition(this)">
          {% for ex in expeditions %}
            <option value="{{ ex.id }}">{{ ex.name }}</option>
          {% endfor %}
        </select>
        <!-- Expedition image will be injected by JS -->
      </div>
      <div id="nightlord-info" class="nightlord-info">
        <!-- Nightlord entries will be injected here by JS -->
      </div>
    </div>

    <div class="character-section">
      <div class="accordion-vertical" id="character-accordion">
        {% for nf in nightfarers %}
        <div class="accordion-item{% if forloop.first %} active{% endif %}" onclick="toggleAccordion(this, 'character')">
          <div class="accordion-title">{{ nf.name }}</div>
          <img src="{{ nf.summary.url }}" alt="{{ nf.name }}">
        </div>
        {% endfor %}
      </div>
    </div>

  </div>
  <!-- 1. Inject the JSON safely -->
  {{ nightlord_data|json_script:"nightlord-data" }}
  {{ expedition_data|json_script:"expedition-data" }}

  <!-- 2. Parse it into a JS variable -->
  <script>
    window.nightlordData = JSON.parse(document.getElementById('nightlord-data').textContent);
    window.expeditionData = JSON.parse(document.getElementById('expedition-data').textContent);
  </script>

  <!-- 3. Load your main JS script -->
  <script src="{% static 'js/base.js' %}"></script>
</body>
</html>
